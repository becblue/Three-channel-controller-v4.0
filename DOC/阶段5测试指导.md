# 阶段5测试指导

**测试模块**：OLED显示驱动（SSD1309）  
**测试日期**：2026-02-13  
**测试版本**：Phase 5  

---

## 一、测试准备

### 1.1 硬件要求

- ✅ STM32F103RCT6核心板
- ✅ 串口调试工具（波特率115200）
- ✅ **OLED显示屏**（2.42英寸，128x64，SSD1309，已连接至PB6/PB7）
- ✅ **I2C上拉电阻**（通常OLED模块已集成）

### 1.2 软件要求

- ✅ Keil MDK-ARM
- ✅ STM32CubeProgrammer
- ✅ 串口调试助手（支持115200波特率）

### 1.3 编译状态

```
编译结果：0 Error, 0 Warning
代码大小：Code=16068 RO-data=948 RW-data=20 ZI-data=2556
```

---

## 二、OLED硬件参数

### 2.1 显示屏规格

| 参数 | 规格 |
|------|------|
| 尺寸 | 2.42英寸 |
| 分辨率 | 128×64像素 |
| 控制芯片 | SSD1309 |
| 显示颜色 | 白色 |
| 显示区域 | 55.01×27.49mm |
| 工作电压 | 3.3V |
| 通信接口 | I2C |

### 2.2 I2C配置

| 参数 | 配置 |
|------|------|
| I2C接口 | I2C1 |
| SCL引脚 | PB6 |
| SDA引脚 | PB7 |
| 时钟速度 | 100kHz |
| 从机地址 | 0x78（8位），0x3C（7位） |
| 超时时间 | 100ms |

### 2.3 显示区域划分

| 区域 | 行范围 | 用途 |
|------|--------|------|
| 报警区 | Row 0-1 | 显示异常信息 |
| 通道区 | Row 2-5 | 显示通道状态 |
| 温度区 | Row 6-7 | 显示温度和风扇信息 |

---

## 三、测试步骤

### 3.1 初始化测试

**测试目的**：验证OLED能否正常初始化

**预期串口输出**：
```
[OLED] Initializing display...
[OLED] Initialization complete
```

**预期OLED显示**：
- 屏幕被清空（全黑）

**验收标准**：
- ✅ 串口输出初始化信息
- ✅ OLED屏幕亮起（背光工作）
- ✅ 显示全黑（无随机亮点）

---

### 3.2 测试1：清屏测试

**串口输出**：
```
[OLED] Test 1: Clear screen
```

**OLED显示**：
- 屏幕完全清空，持续500ms

**验收标准**：
- ✅ 屏幕全黑
- ✅ 无残影
- ✅ 无闪烁

---

### 3.3 测试2：绘图测试

**串口输出**：
```
[OLED] Test 2: Draw lines
```

**OLED显示**：
- 对角线（左上→右下）
- 对角线（左下→右上）
- 矩形框（边缘内缩10像素）
- 持续1秒

**验收标准**：
- ✅ 线条清晰连续
- ✅ 矩形边框完整
- ✅ 无断线或错位

---

### 3.4 测试3：文字显示测试

**串口输出**：
```
[OLED] Test 3: Show text
```

**OLED显示**（预期内容）：
```
OLED Test OK
Resolution:
128x64
Controller:
SSD1309
```

**验收标准**：
- ✅ 文字清晰可读
- ✅ 字符间距均匀
- ✅ 无字符重叠
- ✅ 6x8字体显示正常
- ✅ 持续2秒

---

### 3.5 测试4：LOGO显示测试

**串口输出**：
```
[OLED] Test 4: Show logo
```

**OLED显示**（预期内容）：
```
╔══════════════════════════╗
║                          ║
║    Three-Channel         ║
║      Controller          ║
║         v4.0             ║
║                          ║
╚══════════════════════════╝
```

**验收标准**：
- ✅ LOGO居中显示
- ✅ 边框完整
- ✅ 文字对齐
- ✅ 持续2秒

---

### 3.6 测试5：进度条测试

**串口输出**（每300ms更新一次）：
```
[OLED] Test 5: Progress bar
[OLED] Progress: 0%
[OLED] Progress: 10%
[OLED] Progress: 20%
...
[OLED] Progress: 100%
```

**OLED显示**（动画效果）：
```
    Loading...

┌──────────────────────────┐
│████████░░░░░░░░░░░░░░░░│  30%
└──────────────────────────┘
```

**验收标准**：
- ✅ 进度条平滑增长
- ✅ 百分比数字同步更新
- ✅ 边框完整
- ✅ 无闪烁
- ✅ 从0%到100%动画流畅

---

### 3.7 循环显示测试

**串口输出**（每5秒更新）：
```
[xxxxx ms] OLED Display OK - Phase 5 Running
```

**OLED显示**：
```
System Running
Phase 5 OK
```

**验收标准**：
- ✅ 显示持续更新
- ✅ 无死机
- ✅ 无显示异常

---

## 四、功能验收清单

### 4.1 核心功能

| 功能 | 验收标准 | 状态 |
|------|----------|------|
| I2C通信 | 无通信错误 | ⬜ 待测 |
| OLED初始化 | 成功初始化 | ⬜ 待测 |
| 清屏功能 | 完全清空 | ⬜ 待测 |
| 画点功能 | 像素准确 | ⬜ 待测 |
| 画线功能 | 线条连续 | ⬜ 待测 |
| 矩形绘制 | 边框完整 | ⬜ 待测 |
| 字符显示 | 清晰可读 | ⬜ 待测 |
| 字符串显示 | 正常换行 | ⬜ 待测 |
| LOGO显示 | 居中对齐 | ⬜ 待测 |
| 进度条动画 | 平滑流畅 | ⬜ 待测 |

### 4.2 性能指标

| 指标 | 目标 | 实际 | 状态 |
|------|------|------|------|
| 初始化时间 | <200ms | ____ms | ⬜ 待测 |
| 刷新频率 | >10fps | ____fps | ⬜ 待测 |
| I2C速度 | 100kHz | 100kHz | ✅ 配置 |
| 显示响应 | 即时 | ____ | ⬜ 待测 |

### 4.3 稳定性测试

| 测试项 | 要求 | 状态 |
|--------|------|------|
| 长时间运行 | >1小时无异常 | ⬜ 待测 |
| 重复刷新 | 无残影 | ⬜ 待测 |
| 快速更新 | 无闪烁 | ⬜ 待测 |
| 温度适应 | 常温正常 | ⬜ 待测 |

---

## 五、常见问题

### 5.1 OLED无显示

**症状**：
- 串口输出正常
- OLED屏幕全黑或无反应

**可能原因**：
1. I2C连接问题（SCL/SDA接错）
2. 供电不足（3.3V电压不稳）
3. I2C地址错误
4. OLED模块损坏

**排查步骤**：
1. 检查I2C接线（PB6→SCL，PB7→SDA）
2. 测量3.3V供电电压
3. 用示波器检查I2C信号
4. 尝试修改I2C地址（0x78或0x3A）

---

### 5.2 显示异常或花屏

**症状**：
- 显示内容错乱
- 出现随机亮点
- 显示位置偏移

**可能原因**：
1. I2C通信干扰
2. 刷新缓冲区未正确同步
3. 初始化序列不完整

**解决方法**：
1. 检查I2C上拉电阻（通常4.7KΩ）
2. 增加I2C传输延时
3. 重新上电复位

---

### 5.3 文字显示不清晰

**症状**：
- 字符模糊
- 部分像素缺失
- 字符重叠

**可能原因**：
1. 对比度设置不当
2. 字体数据错误
3. 显示缓冲区溢出

**解决方法**：
1. 调整对比度（使用`OLED_SetBrightness`）
2. 检查字体数组完整性
3. 验证坐标范围

---

### 5.4 I2C通信失败

**症状**：
- 串口输出初始化失败
- HAL_I2C函数返回HAL_ERROR

**可能原因**：
1. I2C时钟配置错误
2. 从机地址不匹配
3. I2C总线被占用

**解决方法**：
1. 检查I2C1时钟使能
2. 尝试0x78或0x3C地址
3. 确认无其他I2C设备冲突
4. 添加I2C复位：
```c
__HAL_RCC_I2C1_FORCE_RESET();
HAL_Delay(1);
__HAL_RCC_I2C1_RELEASE_RESET();
```

---

## 六、测试报告模板

```
阶段5测试报告
测试人员：________
测试时间：________

硬件检查：
☐ OLED连接正确（PB6/PB7）
☐ 供电正常（3.3V）
☐ I2C上拉电阻存在

测试结果：
☐ 初始化测试      [  通过  /  失败  ]
☐ 清屏测试        [  通过  /  失败  ]
☐ 绘图测试        [  通过  /  失败  ]
☐ 文字显示测试    [  通过  /  失败  ]
☐ LOGO显示测试    [  通过  /  失败  ]
☐ 进度条测试      [  通过  /  失败  ]
☐ 循环显示测试    [  通过  /  失败  ]

性能测量：
- 初始化时间：____ms
- 刷新帧率：____fps
- 显示响应：[  即时  /  延迟  ]

问题记录：
______________________________________
______________________________________

测试结论：[  全部通过  /  部分失败  ]

备注：
______________________________________
```

---

## 七、下一步计划

阶段5完成后，进入**阶段6：功能层 - 报警输出控制**

---

**文档版本**：v1.0  
**最后更新**：2026-02-13
