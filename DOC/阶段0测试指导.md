# 阶段0：开发环境准备与验证 - 测试指导

## 测试目标

验证开发环境配置正确，能够正常编译和下载程序，串口通信正常。

---

## 测试前准备

### 硬件准备

- [x] STM32F103RCT6开发板
- [x] ST-Link调试器（或J-Link）
- [x] USB转串口模块（连接到USART3）
- [x] 串口线连接：
  - USART3_TX (PC10) → USB转串口RX
  - USART3_RX (PC11) → USB转串口TX
  - GND → GND

### 软件准备

- [x] Keil MDK-ARM（已安装）
- [x] 串口调试助手（推荐：XCOM、SecureCRT、PuTTY）
- [x] ST-Link驱动（已安装）

---

## 测试步骤

### 步骤1：打开Keil工程

1. 打开Keil MDK-ARM
2. 打开工程文件：`MDK-ARM/Three-channel controller_v4.0.uvprojx`
3. 等待工程加载完成

### 步骤2：编译工程

1. 点击菜单栏 `Project` → `Build Target` 或按快捷键 `F7`
2. 等待编译完成
3. 查看编译输出窗口

**预期结果**：
```
Build target 'Three-channel controller_v4.0'
compiling main.c...
...
linking...
Program Size: Code=xxxxx RO-data=xxx RW-data=xxx ZI-data=xxx  
"Three-channel controller_v4.0.axf" - 0 Error(s), 0 Warning(s).
Build Time Elapsed:  00:00:xx
```

**验收标准**：
- ✅ 编译通过，0 Error，0 Warning
- ✅ 生成.axf和.hex文件

### 步骤3：下载程序

1. 连接ST-Link到开发板
2. 连接ST-Link到电脑USB口
3. 点击菜单栏 `Flash` → `Download` 或按快捷键 `F8`
4. 等待下载完成

**预期结果**：
```
Load "E:\\STM32\\Three-channel controller_v4.0\\MDK-ARM\\Three-channel controller_v4.0\\Three-channel controller_v4.0.axf"
Erase Done.
Programming Done.
Application running ...
```

**验收标准**：
- ✅ 下载成功，无错误
- ✅ 程序开始运行

### 步骤4：配置串口调试助手

1. 打开串口调试助手
2. 配置串口参数：
   - **波特率**：115200
   - **数据位**：8
   - **停止位**：1
   - **校验位**：None
   - **流控**：None
3. 选择正确的COM口
4. 打开串口

### 步骤5：验证串口通信

1. 按下开发板复位按钮
2. 观察串口调试助手接收窗口

**预期结果**：
```
System Ready - Phase 0 Test
System Running...
System Running...
System Running...
...（每秒输出一次）
```

**验收标准**：
- ✅ 能接收到"System Ready - Phase 0 Test"启动消息
- ✅ 能接收到"System Running..."心跳消息（每秒1次）
- ✅ 消息格式正确，无乱码

---

## 测试结果记录

### 编译结果

- [ ] 编译通过，0 Error，0 Warning
- [ ] 程序大小：Code=_____ bytes, RO-data=_____ bytes

### 下载结果

- [ ] 下载成功
- [ ] 程序正常运行

### 串口通信结果

- [ ] 接收到启动消息
- [ ] 接收到心跳消息（每秒1次）
- [ ] 无乱码，格式正确

---

## 常见问题排查

### 问题1：编译错误

**现象**：编译时出现Error

**可能原因**：
1. 缺少必要的库文件
2. 路径配置错误
3. 代码语法错误

**解决方法**：
1. 检查编译错误信息
2. 确认HAL库路径配置正确
3. 重新生成CubeMX代码

### 问题2：下载失败

**现象**：无法下载程序到MCU

**可能原因**：
1. ST-Link连接不正常
2. 目标板供电不正常
3. 芯片被锁定

**解决方法**：
1. 检查ST-Link连接
2. 检查目标板供电（LED指示灯）
3. 使用ST-Link Utility解锁芯片

### 问题3：串口无输出

**现象**：串口调试助手无法接收到数据

**可能原因**：
1. 串口线连接错误
2. 串口参数配置不对
3. COM口选择错误
4. USB转串口驱动未安装

**解决方法**：
1. 检查串口线连接（TX-RX交叉连接）
2. 确认波特率为115200
3. 在设备管理器中查看正确的COM口
4. 安装USB转串口驱动（CH340/PL2303/CP2102等）

### 问题4：串口输出乱码

**现象**：串口能接收到数据，但是乱码

**可能原因**：
1. 波特率设置错误
2. 时钟配置错误

**解决方法**：
1. 确认串口助手波特率为115200
2. 检查SystemClock_Config()配置
3. 确认外部晶振为8MHz

---

## 测试完成标志

当以下所有验收标准都满足时，阶段0测试通过：

- ✅ 工程编译无错误无警告
- ✅ 程序能正常下载到MCU
- ✅ 串口工具能收到"System Ready - Phase 0 Test"消息
- ✅ 串口工具能收到"System Running..."消息（每秒1次）
- ✅ 消息无乱码，格式正确

---

## 下一步

阶段0测试通过后，请通知开发人员：

1. 提交测试报告
2. 等待授权进入阶段1：基础层 - 通用定义模块

---

**测试日期**：________

**测试人员**：________

**测试结果**：[ ] 通过  [ ] 未通过

**备注**：
