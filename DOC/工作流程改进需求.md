# 工作流程改进需求

> 文件说明：记录需要修改的工作流程细节，由用户填写后交由工程师实现。

---

## 待改进项目

<!-- 请在下方填写需要改进的内容 -->
1、系统在启动后的安全自建过程中，需要加去三个通道分别回复默认状态的动作，此动作目的是避免之前因错误操作，倒是某一路继电器至于错误的状态，从而导致开机后自动接通而产生隐患。（已完成）

2、我发现，当我接通一个通道后，此时DC电源丢失，因为这个电源同时也是给外部的使能信号供电，所以，当这个电源丢失也就意味着外部的使能信号也丢失了，但此时应该是输出报警，但对应的通道不应该有复位的动作（即使使能信号丢失，应该先判断DC电源是否存在，如果存在，即视为正常关断，如果DC电源也不存在，应该判定为异常调电，不应该操作通道，之应该输出报警。）（已完成）

3、能否针对风扇的转速驱动以及转速识别使用其他方案实现？目前的方案存在当通道关闭时，会偶尔停转活转速降低后马上又回复的情况，并且目前没有找到根本原因。我想能否通过其他方案实现？（以实现）

4现在我需要开发外部存储功能，用来存储设备的工作状态、错误报警信息，并以开机时间长度为时间戳。要求如下：

A、以设备上电开始计时并记录“开机”标记，用于索引本次开机后的工作状态，下一次开机，才记录一次开机，并且时间戳重新计时。
b、每次通道动作需要记录
C\ 每次产生异常需要记录。
D、PC13为KEY1引脚，当该引脚被拉低，并且持续1秒后，通过串口输出所有存储记录，方便维护人员查看。，PC14为KEY2按钮，当KEY2被拉低并且持续3秒，存储器需要格式化，删除所有信息记录
E\当存储器存储区域达到90%，则再记录的信息需要覆盖最早的记录印记，依此逻辑滚动存储信息。(已完成)

5、我需要增加一个日志在OLED上输出的功能
 a、连续5秒拉低key1 日志输出在OLED上（需要注意，拉低1秒时的功能是输出在串口2上，需要考虑别和这个功能冲突）
 b、日志以分屏输出，没满一个屏幕需要暂停，方便维护人员查看，再次检测到key1短暂拉低（不需要满足时间长度要求），则显示下一页。如果日志显示到最后一页，再次检测到KEY1短暂拉低，则退出日志显示，切换会正常待机界面。
 c、KEY1连续拉低10秒，退出显示日志，切换会正常待机页面。（已完成）

 6，现在我们开始修复风扇在通道断开瞬间会短时间停转的问题
    我进行了一些相关的实验，提供给你，供你分析故障原因：
    a、风扇停转通常在某一个通道接通后断开的一瞬间，风扇会有大约200ms的减速，随后又回复正常转速。
    b、我尝试断开FAN_PWM引脚（即PA6）与风扇的连接，风扇会以全速运转，并且转速读取正常，但是仍然会偶尔出现挺赚的问题，随后又回复
    c、我尝试回复FAN_PWM引脚（即PA6）引脚与风扇的连接后，又断开了FAN_SEN引脚（即PC12）与风扇的连接，后系统运行了半个小时，没有再出现停转的问题，同时，转速读取值为“0”，但是，在通道断开的一瞬间，OLED显示的转速偶尔会有度读数，数值大约在10rpm~30rpm之间，然后又迅速恢复到0.
    d、我不认为时由电磁干扰引起的，因为在这个硬件的基础上，我由另一个项目代码曾经运行过，但是哪个项目的代码没有出现这个情况。









